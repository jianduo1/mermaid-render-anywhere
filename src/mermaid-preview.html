<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid 预览</title>
    <script src="./libs/mermaid.min.js"></script>
    <link rel="stylesheet" href="./webview-styles.css">
</head>
<body class="dark-theme">
    <div class="container">
        <div class="header">
            <div class="title">🎨 {{FUNCTION_NAME}} - Mermaid Preview</div>
            <div class="controls">
                <button class="control-btn" id="scrollLockBtn" title="当前：缩放模式（点击切换为位移模式）">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <circle cx="12" cy="16" r="1"/>
                        <path d="M7 11V7a5 5 0 0 1 5.5-4.9"/>
                    </svg>
                </button>
                <button class="control-btn" id="toggleAllCharts" title="全部图表折叠/展开">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
                <button class="control-btn" id="toggleTheme" title="切换主题">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="content" id="content">
            {{MERMAID_CARDS}}
            <div class="tip-section">
                <div class="tip-title">💡提示词：</div>
                <div class="tip-content">
                    分析这个函数功能，在函数doc注释里面，添加mermaid执行链路工作流。
                </div>
                <div class="tip-title" style="margin-top: 12px;">✋🏻Vibe Coding 最佳实践：</div>
                <div class="tip-content">
                    使用上面提示词让AI分析总结每个函数，然后在代码文件中预览mermaid工作流，开发者只需要理解工作流逻辑，不需要过于关注实现细节。😁
                </div>
            </div>
        </div>
    </div>
    
    <!-- 预览弹窗 -->
    <div class="preview-overlay" id="previewOverlay">
        <div class="preview-modal">
            <div class="preview-header">
                <div class="preview-title" id="previewTitle">图表预览</div>
                <div class="preview-controls">
                    <!-- 缩放控制 -->
                    <button class="preview-btn" onclick="zoomOut()" title="缩小 (-)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                            <line x1="8" y1="11" x2="14" y2="11"/>
                        </svg>
                    </button>
                    <button class="preview-btn" onclick="zoomIn()" title="放大 (+)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                            <line x1="11" y1="8" x2="11" y2="14"/>
                            <line x1="8" y1="11" x2="14" y2="11"/>
                        </svg>
                    </button>
                    
                    <!-- 视图控制 -->
                    <button class="preview-btn" onclick="previewFitToScreen()" title="重置为100%">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15,3 21,3 21,9"/>
                            <polyline points="9,21 3,21 3,15"/>
                            <line x1="21" y1="3" x2="14" y2="10"/>
                            <line x1="3" y1="21" x2="10" y2="14"/>
                        </svg>
                    </button>
                    
                    <!-- 关闭按钮 -->
                    <button class="preview-close" onclick="closePreview()" title="关闭 (Esc)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="preview-content" id="previewContent">
                <!-- 预览内容将在这里显示 -->
            </div>
        </div>
    </div>

    <script src="./webview-script.js"></script>
</body>
</html>